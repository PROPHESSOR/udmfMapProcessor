<!---
 Copyright (c) 2018 PROPHESSOR
 
 This software is released under the MIT License.
 https://opensource.org/licenses/MIT
-->

# UDMF Map Processor Script

В данном файле описан процесс создания скриптов для системы UDMF Map Processor (сокр. UMP).

## Описание файлов

Короткое содержание этого каталога:

- README.md - Информационный файл. Необязателен.
- umpscript.json - Информация о скрипте. Обязателен.
- script.js - Файл с текстом скрипта. Название определяется в umpscript.json. Обязателен

### umpscript.json

Любой UMP скрипт должен содержать файл umpscript.json.
В этом файле содержится информация о самом скрипте, его авторе, параметрах запуска и прочем.

Файл начинается открывающейся фигурной скобкой и заканчивается закрывающейся.
Тело файла состаит из полей и значений, отделяемых друг от друга с помощью символа `:`

Рассмотрим подробнее каждое поле:

- name - Название скрипта (одно слово);
- author - Автор(ы) скрипта;
- version - Версия скрипта в [формате Semver](https://semver.org/lang/ru/);
- description - Описание скрипта;
- url - Адрес сайта/информационной страницы скрипта;
- main - Имя файла с текстом скрипта
- dependencies - Объект зависимостей. *Где поле это название зависимости, а значение - версия*

### README.md

Данный файл создан как руководство по созданию скриптов.
Вы так же можете использовать такие файлы в своих скриптах для подробного описания скрипта, или просто текста.

### script.js

Как было написано выше, данный файл может иметь и другое название - главное, что бы оно было написано так же в поле **main** файла umpscript.json.
Данный файл содержит сам текст скрипта, т.е. является самим скриптом.

Он имеет следующий вид:

```js
module.exports = function(udmfarray, udmfobject, lines) {
    // Здесь будет код скрипта
    return udmf;
}
```

Он принимает 3 аргумента:

- udmfarray     - [udmf массив](#udmfarray-(udmf-массив))
- udmfobject    - [udmf объект](#udmfobject-(udmf-объект))
- lines         - [массив линий](#linesarray-(массив-линий))

Для записи доступен только первый.

Скрипт должен вернуть udmfarray, который передастся следующему скрипту.

**Внимание!** Для скриптинга используется язык программирования JavaScript, так что, Вам следует сначала изучить его, если Вы его ещё не знаете.

## Описание структур и терминов

### udmfarray (udmf массив)

udmf массив служит для представления структуры udmf файла внутри UMP.
Он представляет из себя массив "блоков", расположенных в определенном порядке.

Структура блока:

```js
[тип_блока, {параметры блока}]
```

Всего существует 5 типов блоков:

- thing (предмет)
- linedef (линия)
- sidedef (сторона)
- vertex (вершина)
- sector (сектор)

У каждого из которых свой набор параметров, например, параметры вершины выглядят так:

```js
["vertex", { x: 0.000, y: 0.000 }]
```

Подробнее о параметрах каждого типа блоков можно прочитать [здесь](https://github.com/rheit/zdoom/blob/master/specs/udmf.txt#L244)

### udmfobject (udmf объект)

Данная структура данных представляет собой udmf объект, состоящий из udmf массивов, разделенным по типам блоков.

Имеет следующий вид:

```js
{
    "thing":    []
    "linedef":  [],
    "sidedef":  [],
    "vertex":   [],
    "sector":   []
}
```

Где каждое из полей является соответствующим udmf массивом

### linesarray (массив линий)

Данная структура данных представляет линии точками отсчёта, к которым привязывается сектор, вершины и стороны, что позволяет работать с ними как с одним целым объектом.

Структура линии ("поле": "тип данных"):

```js
{
    "v1":           "udmfarray block", // Первая вершина
    "v2":           "udmfarray block", // Вторая вершина
    "sidefront":    "udmfarray block", // Передняя сторона
    "sideback":     "udmfarray block", // Задняя сторона (если существует)
    "frontsector":  "udmfarray block", // Передний сектор
    "backsector":   "udmfarray block", // Задний сектор (если существует)
    "direction":    "array",           // Направление линии [x, y] в пределах [-1, 1] [TODO:]
    "avg":          "array"            // Центр линии [x, y]
}
```

Обратите внимание на то, что поля, помеченные [TODO:] на данных момент не реализованы.